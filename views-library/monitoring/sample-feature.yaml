Views:
  sample_event_outbox_metrics:
    create: |-
      CREATE OR REPLACE VIEW vw_sample_event_outbox_metrics AS
      SELECT
        DATE(created_at) AS day,
        COUNT(*) AS queued,
        SUM(CASE WHEN status = 'sent' THEN 1 ELSE 0 END) AS sent,
        SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) AS failed
      FROM event_outbox
      GROUP BY DATE(created_at)
      ORDER BY day DESC;
    Requires:
      - event_outbox
    Tags:
      - monitoring
      - ops
    Owner: blackcat-monitoring
FormatVersion: 1.1
