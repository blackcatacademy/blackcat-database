<?php
declare(strict_types=1);
use PHPUnit\Framework\TestCase;
use BlackCat\Core\Database;
final class {{Name}}DeterministicOrderTest extends TestCase {
  public function test_nulls_last_emulation(): void {
    $db = Database::getInstance();
    $tbl = '{{Table}}_ord';
    $db->exec("DROP TABLE IF EXISTS $tbl");
    $db->exec($db->isPg()
      ? "CREATE TABLE $tbl (id BIGSERIAL PRIMARY KEY, created_at TIMESTAMPTZ NULL)"
      : "CREATE TABLE $tbl (id BIGINT PRIMARY KEY AUTO_INCREMENT, created_at TIMESTAMP NULL)");
    $db->exec("INSERT INTO $tbl(created_at) VALUES (NULL),(NULL)");
    if ($db->isPg()) {
      $rows = $db->fetchAll("SELECT id FROM $tbl ORDER BY created_at DESC NULLS LAST, id DESC");
    } else {
      $rows = $db->fetchAll("SELECT id FROM $tbl ORDER BY (CASE WHEN created_at IS NULL THEN 0 ELSE 1 END) DESC, created_at DESC, id DESC");
    }
    $this->assertNotEmpty($rows);
  }
}