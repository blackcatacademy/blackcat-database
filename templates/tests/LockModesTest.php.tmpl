<?php
declare(strict_types=1);
use PHPUnit\Framework\TestCase;
use BlackCat\Core\Database;
final class {{Name}}LockModesTest extends TestCase {
  public function test_skip_locked(): void {
    $db = Database::getInstance();
    $tbl = '{{Table}}_lock';
    $db->exec("DROP TABLE IF EXISTS $tbl");
    $db->exec($db->isPg()
      ? "CREATE TABLE $tbl (id BIGSERIAL PRIMARY KEY, v INT)"
      : "CREATE TABLE $tbl (id BIGINT PRIMARY KEY AUTO_INCREMENT, v INT)");
    $db->exec("INSERT INTO $tbl(v) VALUES (1)");
    $db->begin();
    $db->fetchRow("SELECT * FROM $tbl WHERE id=1 FOR UPDATE");
    $row = $db->fetchRow("SELECT * FROM $tbl WHERE id=1 FOR UPDATE SKIP LOCKED");
    $db->rollBack();
    $this->assertNull($row);
  }
}