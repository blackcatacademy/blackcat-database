Tables:
  payment_gateway_notifications:
    Summary: Inbound notifications from payment gateways (webhooks, IPNs). transaction_id is REQUIRED and UNIQUE.
    Columns:
      id:
        Description: Surrogate primary key.
      status:
        Description: Processing status.
        Enum:
          - pending
          - processing
          - done
          - failed
      received_at:
        Description: When we received the notification (UTC).
      attempts:
        Description: Processing attempts.
      processing_by:
        Description: Worker name processing the event.
      processing_until:
        Description: Lease end.
      transaction_id:
        Description: Gateway transaction id (REQUIRED, UNIQUE).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      last_error:
        Description: Last error message.
      version:
        Description: Optimistic locking version counter.
  schema_registry:
    Summary: Registry of schema versions applied to various components.
    Columns:
      meta:
        Description: JSON metadata with migration context.
      id:
        Description: Surrogate primary key.
      version:
        Description: Version identifier.
      applied_at:
        Description: When the version was applied.
      system_name:
        Description: System/service name.
      component:
        Description: Component name (db, api, etc.).
      checksum:
        Description: Checksum/signature of the migration bundle.
  users:
    Summary: User accounts and authentication attributes.
    Columns:
      actor_role:
        Description: Role within application.
        Enum:
          - customer
          - admin
      email_hash:
        PII: hashed
        Description: Hashed email (salted/peppered). UNIQUE.
      updated_at:
        Description: Update timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      password_hash:
        PII: hashed
        Description: Password hash string.
      last_login_ip_key_version:
        Description: Key version for last_login_ip_hash.
      id:
        Description: Surrogate primary key.
      deleted_at:
        Description: Soft delete timestamp.
      password_algo:
        Description: Password hash algorithm id.
      must_change_password:
        Description: Force password change at next login.
      password_key_version:
        Description: Key/pepper version for passwords.
      is_active:
        Description: Account enabled flag.
      is_locked:
        Description: Lock flag (manual/automatic).
      last_login_ip_hash:
        PII: hashed
        Description: Hashed last login IP.
      failed_logins:
        Description: Failed login counter.
      last_login_at:
        Description: Last successful login (UTC).
      email_hash_key_version:
        Description: Key version for email_hash.
      version:
        Description: Optimistic locking version counter.
  sync_errors:
    Summary: Errors raised while applying replication batches.
    Columns:
      source:
        Description: Source subsystem/channel.
      id:
        Description: Surrogate primary key.
      error:
        Description: Error message.
      event_key:
        Description: Offending event key (if known).
      peer_id:
        Description: Peer involved (FK peer_nodes.id).
      created_at:
        Description: Timestamp when the error was recorded.
  encrypted_fields:
    Summary: Per-field encryption store for arbitrary entities.
    Columns:
      meta:
        Description: Encryption metadata (JSON).
      field_name:
        Description: Encrypted field name.
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Referenced table name.
      ciphertext:
        PII: encrypted
        Description: Encrypted payload.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
      entity_pk:
        Description: Referenced entity primary key (string).
  merkle_anchors:
    Summary: Anchors proving Merkle roots in external systems (files, blockchain, etc.).
    Columns:
      meta:
        Description: JSON metadata tied to the anchor.
      anchor_type:
        Description: Anchor medium.
        Enum:
          - file
          - blockchain
          - notary
      anchor_ref:
        Description: Reference or locator for the anchor.
      merkle_root_id:
        Description: Referenced Merkle root (FK merkle_roots.id).
      id:
        Description: Surrogate primary key.
      anchored_at:
        Description: When the anchor was created.
  user_identities:
    Summary: External identity links (OAuth/OpenID/etc.). One row per (provider, provider_user_id).
    Columns:
      id:
        Description: Surrogate primary key.
      provider_user_id:
        Description: User id at provider. Part of UNIQUE (provider, provider_user_id).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
      provider:
        Description: Provider key (e.g., google, github). Part of UNIQUE (provider, provider_user_id).
      user_id:
        Description: User (FK users.id).
  tenant_domains:
    Summary: Tenant-owned domains used for routing/custom branding.
    Columns:
      domain:
        Description: Original domain string.
      id:
        Description: Surrogate primary key.
      created_at:
        Description: Creation timestamp (UTC).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      is_primary:
        Description: Whether this domain is the tenant primary.
      domain_ci:
        Description: Lowercase domain used for uniqueness.
  replication_lag_samples:
    Summary: Snapshot metrics measuring replication lag per peer.
    Columns:
      peer_id:
        Description: Peer being measured (FK peer_nodes.id).
      captured_at:
        Description: Capture timestamp (UTC).
      metric:
        Description: Metric name (apply_lag_ms, transport_lag_ms).
      id:
        Description: Surrogate primary key.
      value:
        Description: Measured value (ms).
  signing_keys:
    Summary: Inventory of signing keys (local, KMS-backed, or imported).
    Columns:
      private_key_enc:
        Description: Encrypted private key blob.
      private_key_enc_key_version:
        Description: Key version for private_key_enc.
      id:
        Description: Surrogate primary key.
      scope:
        Description: Usage scope (audit, events, assets, ...).
      name:
        Description: Key name / identifier.
      algo_id:
        Description: Signature algorithm (FK crypto_algorithms.id).
      created_at:
        Description: Creation timestamp (UTC).
      public_key:
        Description: Public key bytes.
      origin:
        Description: Key origin.
        Enum:
          - local
          - kms
          - imported
      created_by:
        Description: User who created/uploaded the key.
      activated_at:
        Description: Activation timestamp (UTC).
      notes:
        Description: Operational notes.
      retired_at:
        Description: Retirement timestamp (UTC).
      kms_key_id:
        Description: Backing KMS key if stored hardware-side.
      status:
        Description: Lifecycle status.
        Enum:
          - active
          - retired
          - compromised
  slo_windows:
    Summary: Configured service-level objective windows/targets.
    Columns:
      target_pct:
        Description: Target success percentage.
      id:
        Description: Surrogate primary key.
      window_interval:
        Description: Interval over which the SLO is computed.
      created_at:
        Description: Creation timestamp (UTC).
      objective:
        Description: JSON description of what is being measured.
      name:
        Description: SLO identifier.
  rate_limit_counters:
    Summary: Sliding-window counters for rate limiting enforcement.
    Columns:
      window_start:
        Description: Beginning of the measurement window.
      id:
        Description: Surrogate primary key.
      updated_at:
        Description: Last update timestamp (UTC).
      version:
        Description: Optimistic locking version counter.
      count:
        Description: Number of hits recorded during the window.
      name:
        Description: Rate limiting bucket name.
      window_size_sec:
        Description: Window length in seconds.
      subject_type:
        Description: Entity type being limited (ip,user,api_key,tenant).
      subject_id:
        Description: Identifier of the subject (stringified).
  rbac_user_roles:
    Summary: Assignments of RBAC roles to users.
    Columns:
      id:
        Description: Surrogate primary key.
      granted_at:
        Description: Grant timestamp (UTC).
      scope:
        Description: Additional scope qualifier.
      role_id:
        Description: Role granted (FK rbac_roles.id).
      expires_at:
        Description: Optional expiration time (UTC).
      tenant_id:
        Description: Tenant scope, optional.
      status:
        Description: Assignment status.
        Enum:
          - active
          - revoked
          - expired
      granted_by:
        Description: User/admin who granted the role.
      user_id:
        Description: User receiving the role (FK users.id).
  tax_rates:
    Summary: Tax rates per country and goods category. UNIQUE (country_iso2, category, valid_from).
    Columns:
      valid_from:
        Description: Effective from (date).
      id:
        Description: Surrogate primary key.
      category:
        Description: Tax category.
        Enum:
          - ebook
          - physical
      valid_to:
        Description: Effective to (date), optional.
      rate:
        Description: Tax rate %.
      country_iso2:
        Description: ISO 3166-1 alpha-2 country code.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  kms_keys:
    Summary: External KMS key references. UNIQUE (provider_id, external_key_ref).
    Columns:
      provider_id:
        Description: KMS provider (FK kms_providers.id).
      id:
        Description: Surrogate primary key.
      purpose:
        Description: Primary purpose.
        Enum:
          - wrap
          - encrypt
          - both
      algorithm:
        Description: Algorithm or template id.
      created_at:
        Description: Creation timestamp (UTC).
      status:
        Description: Lifecycle status.
        Enum:
          - active
          - retired
          - disabled
      external_key_ref:
        Description: Provider-specific key identifier. Part of UNIQUE (provider_id, external_key_ref).
  payment_webhooks:
    Summary: Raw webhook payloads (deduplicated by payload_hash UNIQUE).
    Columns:
      id:
        Description: Surrogate primary key.
      payload:
        Description: Original JSON payload.
      created_at:
        Description: Received at (UTC).
      payload_hash:
        Description: Hash of payload for dedupe (UNIQUE).
      payment_id:
        Description: Payment (FK payments.id), optional.
      from_cache:
        Description: Marked if sourced from cache/retry.
      gateway_event_id:
        Description: Gateway event id, optional.
  audit_chain:
    Summary: Hash chain built on top of audit_log entries for tamper evidence.
    Columns:
      prev_hash:
        Description: Hash of the previous audit entry in the chain.
      id:
        Description: Surrogate primary key.
      audit_id:
        Description: Audit entry id (FK audit_log.id).
      chain_name:
        Description: Chain namespace (multiple chains may coexist).
      created_at:
        Description: Creation timestamp (UTC).
      hash:
        Description: Hash of the current entry.
  crypto_keys:
    Summary: Local key registry (DEKs, KEKs, HMAC, peppers).
    Columns:
      created_at:
        Description: Creation timestamp (UTC).
      id:
        Description: Surrogate primary key.
      scope:
        Description: Business scope tag (e.g., orders).
      file_path:
        Description: Filesystem path or vault path.
      fingerprint:
        Description: Key fingerprint / digest.
      key_meta:
        Description: JSON metadata (key parameters).
      version:
        Description: Monotonic version per basename.
      basename:
        Description: Logical key basename.
      origin:
        Description: Key origin.
        Enum:
          - local
          - kms
          - imported
      created_by:
        Description: Admin user who created key (FK users.id).
      activated_at:
        Description: Activation timestamp.
      is_backup_encrypted:
        Description: Backup blob is encrypted with KEK.
      replaced_by:
        Description: Next key id when rotated.
      notes:
        Description: Free-form notes.
      retired_at:
        Description: Retirement timestamp.
      key_type:
        Description: Key purpose type.
        Enum:
          - dek
          - kek
          - hmac
          - pepper
      backup_blob:
        PII: encrypted
        Description: Encrypted backup (binary).
      algorithm:
        Description: Algorithm identifier.
      length_bits:
        Description: Key length in bits.
      status:
        Description: Lifecycle state.
        Enum:
          - active
          - retired
          - compromised
          - archived
      usage:
        Description: "Allowed operations (set/array of values: encrypt,decrypt,sign,verify,wrap,unwrap)."
        Enum:
          - encrypt
          - decrypt
          - sign
          - verify
          - wrap
          - unwrap
      filename:
        Description: Optional filename where stored.
  event_outbox:
    Summary: Outbox table for domain events waiting to be published downstream.
    Columns:
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Originating table.
      producer_node:
        Description: Node that produced the event.
      event_type:
        Description: Event type string.
      next_attempt_at:
        Description: When the next attempt is scheduled.
      event_key:
        Description: Event key / idempotency token.
      payload:
        Description: JSON payload delivered to consumers.
      created_at:
        Description: Creation timestamp (UTC).
      status:
        Description: Delivery status.
        Enum:
          - pending
          - sent
          - failed
      attempts:
        Description: Number of delivery attempts.
      entity_pk:
        Description: Primary key of the originating row.
      processed_at:
        Description: When processing completed.
  notifications:
    Summary: Outbox for templated user notifications.
    Columns:
      template:
        Description: Template identifier.
      retries:
        Description: Attempt counter.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      sent_at:
        Description: Actual send time (UTC).
      locked_by:
        Description: Worker id that holds the lock.
      priority:
        Description: Priority (higher = sooner).
      last_attempt_at:
        Description: Last attempt time (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      payload:
        Description: JSON payload for template rendering.
      locked_until:
        Description: Worker lock until (UTC).
      user_id:
        Description: Target user (optional).
      error:
        Description: Last error message.
      channel:
        Description: Delivery channel.
        Enum:
          - email
          - push
      status:
        Description: Processing status.
        Enum:
          - pending
          - processing
          - sent
          - failed
      scheduled_at:
        Description: Scheduled send time (UTC).
      updated_at:
        Description: Update timestamp (UTC).
      max_retries:
        Description: Maximum attempts.
      next_attempt_at:
        Description: Backoff until (UTC).
      version:
        Description: Optimistic locking version counter.
  retention_enforcement_jobs:
    Summary: Runs of data-retention enforcement tasks.
    Columns:
      id:
        Description: Surrogate primary key.
      started_at:
        Description: Execution start timestamp.
      policy_id:
        Description: Retention policy being enforced (FK data_retention_policies.id).
      error:
        Description: Failure details, if any.
      created_at:
        Description: Creation timestamp (UTC).
      processed_count:
        Description: How many rows were processed.
      scheduled_at:
        Description: Scheduled start time.
      finished_at:
        Description: Execution completion timestamp.
      status:
        Description: Job status.
        Enum:
          - pending
          - running
          - done
          - failed
          - cancelled
  privacy_requests:
    Summary: Data-subject privacy requests (access, erasure, portability, etc.).
    Columns:
      meta:
        Description: JSON blob with additional context.
      requested_at:
        Description: When the request was submitted.
      id:
        Description: Surrogate primary key.
      type:
        Description: Request type.
        Enum:
          - access
          - erasure
          - rectify
          - restrict
          - portability
      status:
        Description: Request status.
        Enum:
          - pending
          - processing
          - done
          - failed
          - cancelled
      processed_at:
        Description: When it was completed.
      user_id:
        Description: Subject user (FK users.id).
  device_fingerprints:
    Summary: Known device/browser fingerprints with derived risk scoring.
    Columns:
      risk_score:
        Description: 0-100 risk score derived from signals.
      id:
        Description: Surrogate primary key.
      fingerprint_hash:
        PII: hashed
        Description: Stable hash of the fingerprint payload.
      fingerprint_hash_key_version:
        Description: Key version for fingerprint_hash.
      last_ip_hash:
        PII: hashed
        Description: Hashed last known IP.
      last_seen:
        Description: Last time the device was observed.
      last_ip_key_version:
        Description: Key version used for last_ip_hash.
      first_seen:
        Description: Timestamp when the device first appeared.
      attributes:
        Description: JSON blob with device characteristics.
      user_id:
        Description: Related user (FK users.id), nullable.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  kms_providers:
    Summary: Configured KMS providers. name is UNIQUE.
    Columns:
      id:
        Description: Surrogate primary key.
      project_tenant:
        Description: Project/tenant id.
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Display name (UNIQUE).
      is_enabled:
        Description: Whether provider is enabled.
      location:
        Description: Region or location.
      provider:
        Description: Provider kind.
        Enum:
          - gcp
          - aws
          - azure
          - vault
  key_rotation_jobs:
    Summary: Planned and executed key rotation jobs.
    Columns:
      id:
        Description: Surrogate primary key.
      started_at:
        Description: Start time (UTC).
      attempts:
        Description: Number of attempts.
      executed_by:
        Description: Operator user id (FK users.id), optional.
      created_at:
        Description: Creation timestamp (UTC).
      basename:
        Description: Key basename to rotate.
      scheduled_at:
        Description: Scheduled time (UTC).
      finished_at:
        Description: Finish time (UTC).
      status:
        Description: Job status.
        Enum:
          - pending
          - running
          - done
          - failed
          - cancelled
      result:
        Description: Result/summary text.
      target_version:
        Description: Desired target version (nullable).
  carts:
    Summary: Carts keyed by UUID; may be anonymous or bound to user.
    Columns:
      created_at:
        Description: Creation timestamp (UTC).
      user_id:
        Description: User owner (FK users.id), optional.
      id:
        Description: Cart id (UUID textual).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      note:
        Description: Optional note attached to the cart.
      updated_at:
        Description: Update timestamp (UTC).
      version:
        Description: Optimistic locking version counter.
  user_profiles:
    Summary: Encrypted user profile blob (optional).
    Columns:
      user_id:
        Description: User (FK users.id), also PK.
      updated_at:
        Description: Last update timestamp (UTC).
      encryption_meta:
        Description: JSON meta of encryption.
      profile_enc:
        PII: encrypted
        Description: Encrypted profile payload.
      key_version:
        Description: Key version for profile_enc.
      version:
        Description: Optimistic locking version counter.
  refunds:
    Summary: Payment refunds and their status.
    Columns:
      currency:
        Description: ISO 4217 currency code.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      created_at:
        Description: Creation timestamp (UTC).
      payment_id:
        Description: Payment (FK payments.id).
      status:
        Description: Gateway/state status label.
      details:
        Description: JSON details from provider.
      reason:
        Description: Reason provided by operator/gateway.
      amount:
        Description: Refund amount (>= 0).
  payments:
    Summary: Payment attempts and final captures for orders.
    Columns:
      currency:
        Description: ISO 4217 currency code.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      updated_at:
        Description: Update timestamp (UTC).
      gateway:
        Description: Payment gateway key (e.g., stripe, gopay).
      details:
        Description: JSON with provider details/receipts.
      provider_event_id:
        Description: Provider event id (optional).
      order_id:
        Description: Order (FK orders.id).
      created_at:
        Description: Creation timestamp (UTC).
      status:
        Description: Payment state.
        Enum:
          - initiated
          - pending
          - authorized
          - paid
          - cancelled
          - partially_refunded
          - refunded
          - failed
      transaction_id:
        Description: Provider transaction id (unique if provided).
      amount:
        Description: Payment amount. Must be >= 0.
      version:
        Description: Optimistic locking version counter.
  kms_routing_policies:
    Summary: Routing directives describing how tenants map to KMS providers.
    Columns:
      strategy:
        Description: Routing strategy.
        Enum:
          - prefer
          - require
          - avoid
      id:
        Description: Surrogate primary key.
      providers:
        Description: JSON list of provider options/weights.
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Policy name.
      active:
        Description: Whether the policy is active.
      priority:
        Description: Priority ordering (higher first).
      match:
        Description: JSON filter describing when to apply the policy.
  order_item_downloads:
    Summary: Per-order download entitlements for digital items. UNIQUE (order_id, book_id, asset_id).
    Columns:
      asset_id:
        Description: Asset (FK book_assets.id).
      token_key_version:
        Description: Key version used for download_token_hash.
      book_id:
        Description: Book (FK books.id).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      version:
        Description: Optimistic locking version counter.
      ip_hash:
        PII: hashed
        Description: Hashed IP of last usage.
      used:
        Description: Number of uses so far.
      max_uses:
        Description: Max allowed downloads.
      is_active:
        Description: Generated flag (used < max_uses).
      order_id:
        Description: Order (FK orders.id).
      expires_at:
        Description: Expiry timestamp (UTC).
      id:
        Description: Surrogate primary key.
      last_used_at:
        Description: Last download timestamp (UTC).
      ip_hash_key_version:
        Description: Key version for ip_hash.
      key_version:
        Description: Content encryption key version.
      download_token_hash:
        PII: hashed
        Description: Hashed download token (dedupe/lookup).
  entity_external_ids:
    Summary: Links between local entities and identifiers in external systems.
    Columns:
      source:
        Description: External system identifier.
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Local table name.
      external_id:
        Description: External ID for the record.
      created_at:
        Description: Creation timestamp (UTC).
      entity_pk:
        Description: Primary key value of the local record.
  book_assets:
    Summary: Binary and ancillary assets for books (covers, files, extras). UNIQUE (book_id, asset_type) â€” max. one asset of a given type per book.
    Columns:
      is_encrypted:
        Description: Whether asset is encrypted at rest.
      id:
        Description: Surrogate primary key.
      storage_path:
        Description: Backend storage path or URI.
      book_id:
        Description: Book (FK books.id).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      content_hash:
        Description: Optional file content hash (hex).
      encryption_iv:
        Description: IV/nonce used for encryption.
      created_at:
        Description: Creation timestamp (UTC).
      size_bytes:
        Description: File size in bytes.
      mime_type:
        Description: MIME type.
      key_version:
        Description: Local key version reference.
      encryption_key_enc:
        PII: encrypted
        Description: Wrapped DEK or encrypted key blob.
      key_id:
        Description: Optional link to crypto_keys.id.
      encryption_tag:
        Description: Auth tag for AEAD ciphers.
      encryption_aad:
        Description: Associated data for AEAD ciphers.
      asset_type:
        Description: Kind of asset.
        Enum:
          - cover
          - pdf
          - epub
          - mobi
          - sample
          - extra
      encryption_meta:
        Description: JSON metadata about encryption layers.
      filename:
        Description: Original file name.
      download_filename:
        Description: Suggested download file name.
      encryption_algo:
        Description: Algorithm identifier (e.g., AES-256-GCM).
  field_hash_policies:
    Summary: Effective hashing policy assignments for sensitive columns.
    Columns:
      field_name:
        Description: Column name.
      id:
        Description: Surrogate primary key.
      effective_from:
        Description: Timestamp when the policy takes effect.
      notes:
        Description: Documentation / migration context.
      entity_table:
        Description: Table where the field lives.
      profile_id:
        Description: Hash profile applied (FK hash_profiles.id).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  rate_limits:
    Summary: Configured rate-limiting rules at the application level.
    Columns:
      id:
        Description: Surrogate primary key.
      active:
        Description: Whether the rule is active.
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Rule/bucket name.
      window_size_sec:
        Description: Window length in seconds.
      subject_type:
        Description: Entity type being limited.
      subject_id:
        Description: Identifier of the subject.
      limit_count:
        Description: Number of allowed operations within the window.
  crypto_standard_aliases:
    Summary: Friendly aliases mapped to crypto_algorithms entries.
    Columns:
      created_at:
        Description: Creation timestamp (UTC).
      alias:
        Description: Alias string (primary key).
      algo_id:
        Description: Target algorithm id (FK crypto_algorithms.id).
      notes:
        Description: Optional documentation or rollout notes.
  vat_validations:
    Summary: External VAT ID validation results (cache).
    Columns:
      id:
        Description: Surrogate primary key.
      raw:
        Description: Raw JSON response payload.
      vat_id:
        Description: VAT identifier as provided.
      valid:
        Description: Validation result (true/false).
      checked_at:
        Description: When checked (UTC).
      country_iso2:
        Description: Country ISO2 of VAT id.
  global_id_registry:
    Summary: ULID/UUID registry for mapping global ids to local tables.
    Columns:
      entity_table:
        Description: Local table name.
      gid:
        Description: Primary ULID identifier.
      entity_pk:
        Description: Local primary key value.
      guid:
        Description: Optional UUID representation.
      created_at:
        Description: Creation timestamp (UTC).
  sessions:
    Summary: Active/expired sessions and their lifecycle.
    Columns:
      last_seen_at:
        Description: Last activity timestamp (UTC).
      ip_hash_key_version:
        Description: Key version for ip_hash.
      created_at:
        Description: Creation timestamp (UTC).
      ip_hash:
        PII: hashed
        Description: Hashed client IP.
      token_hash:
        PII: hashed
        Description: Hashed session token.
      token_issued_at:
        Description: Original token issue time (UTC).
      session_blob:
        PII: encrypted
        Description: Optional encrypted session payload.
      user_id:
        Description: User (FK users.id), optional.
      token_fingerprint:
        PII: hashed
        Description: Stable token fingerprint (hashed).
      expires_at:
        Description: Expiration timestamp (UTC).
      revoked:
        Description: Revocation flag.
      id:
        Description: Surrogate primary key.
      last_failed_decrypt_at:
        Description: Timestamp of last failed decrypt.
      failed_decrypt_count:
        Description: Number of failed decrypt attempts.
      token_hash_key_version:
        Description: Key version for token_hash.
      user_agent:
        Description: Client user agent.
      version:
        Description: Optimistic locking version counter.
  key_wrapper_layers:
    Summary: Individual layers that compose a key wrapper.
    Columns:
      meta:
        Description: Additional JSON metadata.
      layer_no:
        Description: Layer order (1..N).
      id:
        Description: Surrogate primary key.
      kem_ciphertext:
        Description: Ciphertext blob for the wrapped key material.
      encap_pubkey:
        Description: Optional encapsulated public key.
      aad:
        Description: JSON AAD metadata used during wrapping.
      created_at:
        Description: Creation timestamp (UTC).
      key_wrapper_id:
        Description: Parent key wrapper (FK key_wrappers.id).
      kms_key_id:
        Description: KMS key used for the layer, if any.
      kem_algo_id:
        Description: KEM algorithm used for wrapping (FK crypto_algorithms.id).
  order_items:
    Summary: Normalized order line items (snapshotted data).
    Columns:
      quantity:
        Description: Quantity (> 0).
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      sku_snapshot:
        Description: Captured SKU at purchase time.
      tax_rate:
        Description: Tax rate % (0..100).
      product_ref:
        Description: External product reference (optional).
      title_snapshot:
        Description: Captured title at purchase time.
      unit_price:
        Description: Unit price at purchase.
      book_id:
        Description: Book (FK books.id), optional for non-book items.
      currency:
        Description: ISO 4217 currency code.
      order_id:
        Description: Order (FK orders.id).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  idempotency_keys:
    Summary: Idempotency keys to deduplicate external payment/API requests.
    Columns:
      gateway_payload:
        Description: Original payload JSON.
      key_hash:
        PII: token
        Description: Key hash (natural PK).
      key_hash_key_version:
        Description: Key version used for key_hash.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      created_at:
        Description: Creation timestamp (UTC).
      payment_id:
        Description: Related payment (FK payments.id), optional.
      order_id:
        Description: Related order (FK orders.id), optional.
      ttl_seconds:
        Description: Time-to-live in seconds (> 0).
      redirect_url:
        Description: Client redirect URL (if any).
  invoices:
    Summary: Issued invoices linked to orders. invoice_number is UNIQUE.
    Columns:
      order_id:
        Description: Order (FK orders.id), optional.
      due_date:
        Description: Due date (optional).
      variable_symbol:
        Description: Local payment identifier/VS.
      created_at:
        Description: Creation timestamp (UTC).
      invoice_number:
        Description: Unique invoice number (UNIQUE).
      discount_total:
        Description: Total discount amount.
      subtotal:
        Description: Subtotal excl. discounts & tax.
      tax_total:
        Description: Total tax amount.
      issue_date:
        Description: Issue date.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      currency:
        Description: ISO 4217 currency code.
      total:
        Description: Grand total.
      qr_data:
        Description: Encoded payment data (string/QR).
  event_dlq:
    Summary: Dead-letter queue holding events that failed permanently.
    Columns:
      source:
        Description: Event source or producer system.
      first_failed_at:
        Description: Timestamp of the first failure.
      id:
        Description: Surrogate primary key.
      event_key:
        Description: Event key / idempotency token.
      error:
        Description: Error message explaining the failure.
      event:
        Description: Original event payload (JSON).
      retryable:
        Description: Whether the event can be retried safely.
      last_failed_at:
        Description: Timestamp of the latest failure.
      attempts:
        Description: How many attempts were made.
  books:
    Summary: Books catalog with pricing and stock flags.
    Columns:
      created_at:
        Description: Creation timestamp (UTC).
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      publisher:
        Description: Publisher name.
      updated_at:
        Description: Update timestamp (UTC).
      published_at:
        Description: Publication date.
      slug:
        Description: URL-friendly unique slug.
      slug_ci:
        Description: Generated lowercase slug used for case-insensitive uniqueness.
      is_available:
        Description: Available for purchase/download.
      author_id:
        Description: Author (FK authors.id).
      short_description:
        Description: Short blurb.
      title:
        Description: Book title.
      deleted_at:
        Description: Soft delete timestamp.
      isbn:
        Description: ISBN identifier.
      full_description:
        Description: Long description (rich text allowed).
      price:
        Description: Current unit price.
      is_active:
        Description: Visible in catalog.
      stock_quantity:
        Description: Units in stock.
      main_category_id:
        Description: Primary category (FK categories.id).
      currency:
        Description: ISO 4217 currency code (3 letters).
      language:
        Description: Language code (e.g., en, cs).
      sku:
        Description: Stock keeping unit.
      pages:
        Description: Number of pages (if applicable).
      version:
        Description: Optimistic locking version counter.
      is_live:
        Description: Generated flag (deleted_at IS NULL).
  cart_items:
    Summary: Items added to shopping carts. UNIQUE (cart_id, book_id, sku) to prevent duplicate items in the cart.
    Columns:
      currency:
        Description: ISO 4217 currency code.
      sku:
        Description: SKU snapshot.
      sku_norm:
        Description: Generated normalized SKU (COALESCE(sku, '')).
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      variant:
        Description: JSON with selected variant/options.
      unit_price:
        Description: Unit price at time of adding.
      meta:
        Description: Additional JSON metadata.
      quantity:
        Description: Quantity > 0.
      book_id:
        Description: Book (FK books.id).
      cart_id:
        Description: Cart identifier (UUID textual).
      price_snapshot:
        Description: Cached line price for integrity.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  orders:
    Summary: Orders lifecycle, totals, and encrypted customer blob.
    Columns:
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      updated_at:
        Description: Update timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      discount_total:
        Description: Discount total.
      metadata:
        Description: JSON with auxiliary metadata.
      public_order_no:
        Description: Human-friendly order number.
      subtotal:
        Description: Subtotal amount.
      encrypted_customer_blob_key_version:
        Description: Key version of encrypted blob.
      encryption_meta:
        Description: JSON encryption metadata.
      payment_method:
        Description: Selected payment method.
      user_id:
        Description: Customer (FK users.id), optional (guest checkout).
      tax_total:
        Description: Tax total.
      total:
        Description: Grand total.
      status:
        Description: Order state.
        Enum:
          - pending
          - paid
          - failed
          - cancelled
          - refunded
          - completed
      currency:
        Description: ISO 4217 currency code.
      uuid_bin:
        Description: UUID binary form (unique, for compact lookups).
      encrypted_customer_blob:
        PII: encrypted
        Description: Encrypted PII/customer details.
      uuid:
        Description: Unique external order id (UUID text).
      version:
        Description: Optimistic locking version counter.
  login_attempts:
    Summary: Login attempts per IP and (optional) user.
    Columns:
      id:
        Description: Surrogate primary key.
      auth_event_id:
        Description: Link to auth_events record, optional.
      attempted_at:
        Description: Attempt time (UTC).
      ip_hash:
        PII: hashed
        Description: Hashed client IP.
      ip_hash_key_version:
        Description: Key version for ip_hash.
      success:
        Description: Whether authentication succeeded.
      username_hash:
        PII: hashed
        Description: Hashed username/email provided.
      username_hash_key_version:
        Description: Key version for username_hash.
      user_id:
        Description: User (FK users.id), optional.
  deletion_jobs:
    Summary: Asynchronous deletion workflows coordinating cascading cleanup.
    Columns:
      hard_delete:
        Description: Whether to permanently delete the row.
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Target table for the deletion.
      started_at:
        Description: Processing start timestamp (UTC).
      error:
        Description: Failure description, if any.
      created_at:
        Description: Creation timestamp (UTC).
      status:
        Description: Job status flag.
        Enum:
          - pending
          - running
          - done
          - failed
          - cancelled
      reason:
        Description: Reason the deletion was requested.
      scheduled_at:
        Description: When the job should start.
      finished_at:
        Description: Completion timestamp (UTC).
      entity_pk:
        Description: Primary key of the row to delete.
      created_by:
        Description: User/admin that created the job.
  crypto_algorithms:
    Summary: Catalog of supported cryptographic primitives.
    Columns:
      params:
        Description: JSON metadata with algorithm-specific parameters.
      id:
        Description: Surrogate primary key.
      variant:
        Description: Optional variant descriptor (hybrid, FIPS profile, etc.).
      variant_norm:
        Description: Generated normalized variant (IFNULL(variant, '')).
      nist_level:
        Description: Post-quantum NIST security level, if any.
      created_at:
        Description: Catalog insertion timestamp (UTC).
      name:
        Description: Canonical algorithm name (e.g., ML-KEM-768).
      status:
        Description: Lifecycle flag.
        Enum:
          - active
          - deprecated
          - experimental
      class:
        Description: Algorithm class.
        Enum:
          - kem
          - sig
          - hash
          - symmetric
  reviews:
    Summary: User reviews and ratings for books. UNIQUE (book_id, user_id) â€” one user can only rate a book once.
    Columns:
      review_text:
        Description: Free-form review text.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      updated_at:
        Description: Last update (UTC), optional.
      rating:
        Description: Rating 1..5.
      created_at:
        Description: Creation timestamp (UTC).
      book_id:
        Description: Book (FK books.id).
      user_id:
        Description: Authoring user (FK users.id), optional.
  pq_migration_jobs:
    Summary: Jobs that migrate stored data to PQ-safe hashing/encryption policies.
    Columns:
      processed_count:
        Description: How many records were processed.
      scope:
        Description: What is being migrated (hashes, wrappers, signatures).
      finished_at:
        Description: Completion timestamp.
      created_at:
        Description: Creation timestamp (UTC).
      started_at:
        Description: When the job started.
      target_algo_id:
        Description: Target crypto algorithm id, optional.
      created_by:
        Description: User who enqueued the job.
      selection:
        Description: JSON selector describing the affected dataset.
      error:
        Description: Failure cause, if any.
      id:
        Description: Surrogate primary key.
      status:
        Description: Execution status.
        Enum:
          - pending
          - running
          - done
          - failed
          - cancelled
      target_policy_id:
        Description: Target encryption policy id, optional.
      scheduled_at:
        Description: Scheduled start time.
  policy_kms_keys:
    Summary: KMS key assignments per encryption policy. PRIMARY KEY (policy_id, kms_key_id).
    Columns:
      priority:
        Description: Priority (higher first).
      policy_id:
        Description: Policy (FK encryption_policies.id).
      kms_key_id:
        Description: KMS key (FK kms_keys.id).
      weight:
        Description: Weight for selection algorithms.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  sync_batches:
    Summary: Batches of events replicated between peers.
    Columns:
      consumer_peer_id:
        Description: Consuming peer (FK peer_nodes.id).
      id:
        Description: Surrogate primary key.
      started_at:
        Description: Processing start timestamp.
      items_failed:
        Description: Number of events that failed.
      items_ok:
        Description: Number of events applied successfully.
      error:
        Description: Batch-level error, if any.
      created_at:
        Description: Creation timestamp (UTC).
      channel:
        Description: Logical replication channel.
      items_total:
        Description: Total number of events in the batch.
      status:
        Description: Batch status.
        Enum:
          - pending
          - sending
          - completed
          - failed
          - cancelled
      finished_at:
        Description: Processing completion timestamp.
      producer_peer_id:
        Description: Producing peer (FK peer_nodes.id).
  encryption_bindings:
    Summary: Bindings assigning specific key wrappers to encrypted entity fields.
    Columns:
      field_name:
        Description: Encrypted column name; NULL = whole row binding.
      field_name_norm:
        Description: Generated normalized field name (IFNULL(field_name, '')).
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Table name containing encrypted data.
      created_at:
        Description: Creation timestamp (UTC).
      key_wrapper_id:
        Description: Assigned key wrapper (FK key_wrappers.id).
      entity_pk:
        Description: Primary key value of the encrypted row.
  peer_nodes:
    Summary: Known database/application peers for replication and sync.
    Columns:
      meta:
        Description: JSON metadata describing the peer.
      id:
        Description: Surrogate primary key.
      type:
        Description: Peer type.
        Enum:
          - postgres
          - mysql
          - app
          - service
      last_seen:
        Description: Last heartbeat timestamp.
      created_at:
        Description: Registration timestamp (UTC).
      name:
        Description: Peer display name.
      location:
        Description: Optional region / data center.
      status:
        Description: Health status.
        Enum:
          - active
          - offline
          - degraded
          - disabled
  rbac_user_permissions:
    Summary: Direct permission grants to users (outside of roles).
    Columns:
      permission_id:
        Description: Permission id (FK permissions.id).
      id:
        Description: Surrogate primary key.
      effect:
        Description: Allow or deny flag.
        Enum:
          - allow
          - deny
      granted_at:
        Description: Grant timestamp (UTC).
      scope:
        Description: Additional scope qualifier (string).
      granted_by:
        Description: User/admin who granted the permission.
      expires_at:
        Description: Optional expiration time (UTC).
      tenant_id:
        Description: Tenant scope, optional.
      user_id:
        Description: User receiving the grant (FK users.id).
  kms_health_checks:
    Summary: Periodic health probes for KMS providers/keys.
    Columns:
      provider_id:
        Description: KMS provider being checked (FK kms_providers.id).
      id:
        Description: Surrogate primary key.
      latency_ms:
        Description: Measured latency in milliseconds.
      error:
        Description: Error string when degraded/down.
      kms_key_id:
        Description: Specific key being checked (FK kms_keys.id), optional.
      status:
        Description: Probe result.
        Enum:
          - up
          - degraded
          - down
      checked_at:
        Description: Timestamp of the check (UTC).
  tenants:
    Summary: Top-level tenant/organization records used for multi-tenancy.
    Columns:
      slug:
        Description: Canonical slug (unique per tenant).
      id:
        Description: Surrogate primary key.
      deleted_at:
        Description: Soft-delete timestamp.
      is_live:
        Description: Generated flag (deleted_at IS NULL).
      version:
        Description: Optimistic locking version counter.
      created_at:
        Description: Creation timestamp (UTC).
      slug_ci:
        Description: Lowercase slug used for case-insensitive uniqueness.
      name:
        Description: Tenant display name.
      updated_at:
        Description: Last update timestamp (UTC).
      status:
        Description: Tenant status.
        Enum:
          - active
          - suspended
          - deleted
  email_verifications:
    Summary: Email verification tokens for users.
    Columns:
      token_hash:
        PII: token
        Description: Full token hash (hex/char).
      id:
        Description: Surrogate primary key.
      key_version:
        Description: Key version used for hashing/encryption.
      selector:
        Description: Short public selector (unique).
      created_at:
        Description: Creation timestamp (UTC).
      used_at:
        Description: When token was used, if so.
      expires_at:
        Description: Expiration timestamp (UTC).
      validator_hash:
        PII: hashed
        Description: Hashed validator part.
      user_id:
        Description: Related user (FK users.id).
  password_resets:
    Summary: Password reset tokens for users.
    Columns:
      id:
        Description: Surrogate primary key.
      user_id:
        Description: Related user (FK users.id).
      token_hash:
        PII: token
        Description: Full token hash (hex/char).
      selector:
        Description: Short public selector (unique).
      validator_hash:
        PII: hashed
        Description: Hashed validator part.
      key_version:
        Description: Key version used for hashing/encryption.
      expires_at:
        Description: Expiration timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      used_at:
        Description: When token was used, if so.
      ip_hash:
        PII: hashed
        Description: Hashed requester IP.
      ip_hash_key_version:
        Description: Key version for ip_hash.
      user_agent:
        Description: Requester user agent.
  device_codes:
    Summary: OAuth device-code flow storage (issued codes + approval payload).
    Columns:
      id:
        Description: Surrogate primary key.
      device_code_hash:
        PII: token
        Description: Deterministic hash of device_code (HMAC; used for polling lookup).
      device_code_hash_key_version:
        Description: Key version used for device_code_hash.
      device_code:
        PII: token
        Description: Encrypted device_code (envelope).
      device_code_key_version:
        Description: Key version used for device_code encryption.
      user_code_hash:
        PII: token
        Description: Deterministic hash of user_code (HMAC; used for activation lookup).
      user_code_hash_key_version:
        Description: Key version used for user_code_hash.
      client_id:
        Description: OAuth client id requesting the device code.
      scopes:
        Description: Requested scopes (JSON array).
      token_payload:
        PII: token
        Description: Encrypted token payload issued after approval (envelope JSON).
      token_payload_key_version:
        Description: Key version used for token_payload encryption.
      interval_sec:
        Description: Recommended polling interval in seconds.
      approved_at:
        Description: When the device code was approved by the user (UTC).
      expires_at:
        Description: Expiration timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
  magic_links:
    Summary: One-time magic-link tokens (fingerprint-only, server-side stored).
    Columns:
      id:
        Description: Surrogate primary key.
      fingerprint:
        PII: token
        Description: HMAC fingerprint of the magic-link token.
      subject:
        Description: Subject identifier (typically users.id).
      user_id:
        Description: Optional FK users.id for convenience joins.
      context:
        Description: Context metadata (e.g., redirect) as JSON.
      expires_at:
        Description: Expiration timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
  webauthn_credentials:
    Summary: WebAuthn credentials (passkeys) stored per RP id and user.
    Columns:
      id:
        Description: Surrogate primary key.
      rp_id:
        Description: Relying Party ID (domain).
      subject:
        Description: Subject identifier (typically users.id).
      user_id:
        Description: Optional FK users.id for convenience joins.
      credential_id:
        Description: Credential identifier (base64/url-safe).
      public_key:
        Description: Public key material for the credential.
      added_at:
        Description: When the credential was added (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      last_used_at:
        Description: When the credential was last used, if tracked.
      sign_count:
        Description: WebAuthn signature counter (for clone/replay detection).
  webauthn_challenges:
    Summary: WebAuthn pending challenges (registration/authentication) stored server-side.
    Columns:
      id:
        Description: Surrogate primary key.
      rp_id:
        Description: Relying Party ID (domain).
      challenge_hash:
        PII: token
        Description: SHA-256 hash of the challenge (hex).
      metadata:
        Description: Stored challenge metadata as JSON (type, subject, allowed credentials).
      expires_at:
        Description: Expiration timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
  rewrap_jobs:
    Summary: Key rewrap tasks that move ciphertexts to new key wrappers/KMS keys.
    Columns:
      attempts:
        Description: Retry counter.
      id:
        Description: Surrogate primary key.
      started_at:
        Description: Processing start timestamp.
      target_kms2_key_id:
        Description: Target secondary KMS key.
      created_at:
        Description: Creation timestamp (UTC).
      key_wrapper_id:
        Description: Wrapper being rewrapped (FK key_wrappers.id).
      finished_at:
        Description: Processing completion timestamp.
      scheduled_at:
        Description: Scheduled start time.
      target_kms1_key_id:
        Description: Target primary KMS key.
      status:
        Description: Job status flag.
        Enum:
          - pending
          - running
          - done
          - failed
      last_error:
        Description: Last error message observed.
  system_errors:
    Summary: Application error/event log with grouping and resolution.
    Columns:
      url:
        Description: Request URL.
      created_at:
        Description: First occurrence (UTC).
      id:
        Description: Surrogate primary key.
      ip_hash_key_version:
        Description: Key version for ip_hash.
      line:
        Description: Source line number.
      level:
        Description: Severity level.
        Enum:
          - notice
          - warning
          - error
          - critical
      fingerprint:
        Description: Deduplication fingerprint.
      ip_hash:
        PII: hashed
        Description: Hashed IP.
      context:
        Description: JSON context (structured).
      resolved_by:
        Description: Resolver user id (FK users.id), optional.
      stack_trace:
        Description: Long stack trace.
      file:
        Description: Source file path.
      user_id:
        Description: Related user (optional).
      resolved_at:
        Description: Resolution timestamp (UTC).
      message:
        Description: Error message.
      token:
        Description: Correlated token/id.
      exception_class:
        Description: Exception class name (if any).
      method:
        Description: HTTP method.
      last_seen:
        Description: Most recent occurrence (UTC).
      resolved:
        Description: Resolution flag.
      http_status:
        Description: HTTP status code.
      occurrences:
        Description: Aggregate count of occurrences.
      user_agent:
        Description: User agent string.
  rbac_role_permissions:
    Summary: Permission rules bundled with RBAC roles.
    Columns:
      effect:
        Description: Permit or deny flag.
        Enum:
          - allow
          - deny
      role_id:
        Description: Role identifier (FK rbac_roles.id).
      permission_id:
        Description: Permission identifier (FK permissions.id).
      source:
        Description: Whether the rule came from repo or local overrides.
        Enum:
          - repo
          - local
      created_at:
        Description: Creation timestamp (UTC).
  verify_events:
    Summary: Verification events (email/phone, other checks).
    Columns:
      meta:
        Description: JSON metadata.
      id:
        Description: Surrogate primary key.
      type:
        Description: Verification type.
        Enum:
          - verify_success
          - verify_failure
      ip_hash_key_version:
        Description: Key version for ip_hash.
      ip_hash:
        PII: hashed
        Description: Hashed IP.
      user_agent:
        Description: Client user agent.
      occurred_at:
        Description: When event occurred (UTC).
      user_id:
        Description: Related user (FK users.id), optional.
  payment_logs:
    Summary: Plaintext logs per payment.
    Columns:
      log_at:
        Description: Log time (UTC).
      payment_id:
        Description: Payment (FK payments.id).
      message:
        Description: Log message.
      id:
        Description: Surrogate primary key.
  encryption_policy_bindings:
    Summary: History of which encryption policy applies to a field.
    Columns:
      field_name:
        Description: Column that the policy covers.
      id:
        Description: Surrogate primary key.
      effective_from:
        Description: Timestamp when the policy becomes active.
      policy_id:
        Description: Policy identifier (FK encryption_policies.id).
      notes:
        Description: Documentation / rollout notes.
      entity_table:
        Description: Table name.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  book_categories:
    Summary: Many-to-many relationship between books and categories.
    Columns:
      book_id:
        Description: Book (FK books.id).
      category_id:
        Description: Category (FK categories.id).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  key_events:
    Summary: Operational log for crypto key lifecycle and usage.
    Columns:
      meta:
        Description: JSON meta about event.
      source:
        Description: Origin of event.
        Enum:
          - cron
          - admin
          - api
          - manual
      id:
        Description: Surrogate primary key.
      event_type:
        Description: Event type.
        Enum:
          - created
          - rotated
          - activated
          - retired
          - compromised
          - deleted
          - used_encrypt
          - used_decrypt
          - access_failed
          - backup
          - restore
      job_id:
        Description: Batch/job id, optional.
      created_at:
        Description: Timestamp (UTC).
      basename:
        Description: Key basename, if id not present.
      actor_id:
        Description: Actor (FK users.id), optional.
      key_id:
        Description: Key (FK crypto_keys.id), optional.
      note:
        Description: Free-form note.
  slo_status:
    Summary: Computed status entries for service-level objectives.
    Columns:
      total_events:
        Description: Total events observed.
      id:
        Description: Surrogate primary key.
      window_id:
        Description: SLO window (FK slo_windows.id).
      computed_at:
        Description: Timestamp when the SLO was evaluated.
      sli_value:
        Description: Measured SLI value.
      good_events:
        Description: Number of good events counted.
      status:
        Description: Evaluation result.
        Enum:
          - good
          - breach
          - unknown
  permissions:
    Summary: Application permission catalog.
    Columns:
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
      description:
        Description: Human description.
      name:
        Description: Unique permission name.
      id:
        Description: Surrogate primary key.
  coupons:
    Summary: Discount coupons configuration.
    Columns:
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      type:
        Description: Discount type.
        Enum:
          - percent
          - fixed
      updated_at:
        Description: Update timestamp (UTC).
      starts_at:
        Description: Validity start (date).
      min_order_amount:
        Description: Minimum order subtotal to apply (optional).
      value:
        Description: Discount value (percent or fixed).
      created_at:
        Description: Creation timestamp (UTC).
      applies_to:
        Description: JSON targeting (SKUs, categories, users).
      max_redemptions:
        Description: Max total redemptions across users (0 = unlimited).
      is_active:
        Description: Whether coupon is currently active.
      currency:
        Description: ISO 4217 currency for fixed discounts; NULL for percent.
      ends_at:
        Description: Validity end (date), nullable.
      code:
        Description: Unique coupon code (case-sensitive).
      code_ci:
        Description: Generated lowercase code used for case-insensitive uniqueness.
  migration_events:
    Summary: Records describing migrations between schema versions.
    Columns:
      meta:
        Description: JSON metadata or logs.
      id:
        Description: Surrogate primary key.
      started_at:
        Description: Migration start timestamp (UTC).
      system_name:
        Description: System/component undergoing migration.
      from_version:
        Description: Version migrated from.
      to_version:
        Description: Target version.
      finished_at:
        Description: Completion timestamp (UTC).
      status:
        Description: Migration status.
        Enum:
          - pending
          - running
          - done
          - failed
          - cancelled
      error:
        Description: Failure message, if any.
  encryption_policies:
    Summary: Encryption policy registry and parameters. policy_name is UNIQUE.
    Columns:
      mode:
        Description: Execution mode.
        Enum:
          - local
          - kms
          - multi-kms
      id:
        Description: Surrogate primary key.
      max_layers:
        Description: Maximum layers.
      aad_template:
        Description: AAd JSON template.
      notes:
        Description: Free-form notes.
      created_at:
        Description: Creation timestamp (UTC).
      min_layers:
        Description: Minimum layers.
      layer_selection:
        Description: Layer selection algorithm.
        Enum:
          - defined
          - round_robin
          - random
          - hash_mod
      policy_name:
        Description: Unique policy name (UNIQUE).
  coupon_redemptions:
    Summary: Records of coupon usage per order and user.
    Columns:
      amount_applied:
        Description: Applied discount amount.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      coupon_id:
        Description: Coupon (FK coupons.id).
      order_id:
        Description: Order (FK orders.id).
      redeemed_at:
        Description: When coupon was redeemed (UTC).
      user_id:
        Description: User (FK users.id).
  rbac_repositories:
    Summary: Sources of RBAC definitions (git repos, APIs, etc.).
    Columns:
      url:
        Description: Optional URL/endpoint.
      id:
        Description: Surrogate primary key.
      last_commit:
        Description: Hash/identifier of the last synced commit.
      signing_key_id:
        Description: Signing key used to verify snapshots (FK signing_keys.id).
      last_synced_at:
        Description: Last successful sync time.
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Repository identifier.
      status:
        Description: Repository status.
        Enum:
          - active
          - disabled
  user_consents:
    Summary: Captured consents per user and version. UNIQUE (user_id, consent_type, version).
    Columns:
      source:
        Description: Source (e.g., web, import).
      consent_type:
        Description: Consent type key.
      granted:
        Description: Granted flag (true/false).
      id:
        Description: Surrogate primary key.
      version:
        Description: Document/policy version string.
      meta:
        Description: JSON meta (IP, UA, doc hash).
      granted_at:
        Description: When consent was recorded (UTC).
      user_id:
        Description: User (FK users.id).
  hash_profiles:
    Summary: Reusable hashing profiles (algorithm + parameters).
    Columns:
      algo_id:
        Description: Hash algorithm (FK crypto_algorithms.id).
      id:
        Description: Surrogate primary key.
      params:
        Description: JSON with algorithm-specific tweaks.
      created_at:
        Description: Creation timestamp (UTC).
      output_len:
        Description: Optional truncated output length in bytes.
      name:
        Description: Profile identifier.
      status:
        Description: Lifecycle flag.
        Enum:
          - active
          - deprecated
  invoice_items:
    Summary: Normalized invoice line items.
    Columns:
      line_total:
        Description: Total incl. tax for line.
      tax_amount:
        Description: Tax amount.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      invoice_id:
        Description: Invoice (FK invoices.id).
      description:
        Description: Line description.
      unit_price:
        Description: Unit price excl. tax.
      quantity:
        Description: Quantity (> 0).
      line_no:
        Description: Line number within invoice.
      tax_rate:
        Description: Tax rate % (0..100).
      currency:
        Description: ISO 4217 currency code.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  api_keys:
    Summary: Tenant/user scoped API tokens stored only as hashed secrets.
    Columns:
      id:
        Description: Surrogate primary key.
      updated_at:
        Description: Last update timestamp (UTC).
      scopes:
        Description: JSON array with granted scopes.
      name_ci:
        Description: Case-insensitive token label (generated).
      created_at:
        Description: Creation timestamp (UTC).
      token_hash:
        PII: hashed
        Description: Hashed token payload.
      name:
        Description: Human-friendly token label.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      user_id:
        Description: User that created the token (FK users.id), optional.
      expires_at:
        Description: Optional expiration timestamp.
      status:
        Description: Lifecycle status flag.
        Enum:
          - active
          - revoked
          - disabled
      last_used_at:
        Description: Last usage timestamp (UTC).
      token_hash_key_version:
        Description: Key version used when hashing the token.
  rbac_roles:
    Summary: RBAC role definitions synchronized from repositories.
    Columns:
      slug:
        Description: Stable role slug.
      id:
        Description: Surrogate primary key.
      updated_at:
        Description: Last update timestamp (UTC).
      version:
        Description: Version number from the repo.
      description:
        Description: Optional description.
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Human name of the role.
      repo_id:
        Description: Owning repository (FK rbac_repositories.id).
      status:
        Description: Lifecycle status.
        Enum:
          - active
          - deprecated
          - archived
  authors:
    Summary: Authors and aggregate rating counters.
    Columns:
      avg_rating:
        Description: Average rating (derived).
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      last_rating_at:
        Description: Timestamp of last rating.
      name:
        Description: Author display name.
      name_ci:
        Description: Generated lowercase name used for case-insensitive search/uniqueness.
      photo_url:
        Description: Profile photo URL.
      slug:
        Description: URL-friendly unique slug.
      slug_ci:
        Description: Generated lowercase slug used for case-insensitive uniqueness.
      created_at:
        Description: Row creation time (UTC).
      bio:
        Description: Short biography.
      rating_sum:
        Description: Sum of rating values.
      books_count:
        Description: Denormalized number of books.
      deleted_at:
        Description: Soft delete timestamp.
      ratings_count:
        Description: Total ratings count.
      story:
        Description: Long-form story/notes.
      updated_at:
        Description: Row update time (UTC).
      version:
        Description: Optimistic locking version counter.
      is_live:
        Description: Generated flag (deleted_at IS NULL).
  categories:
    Summary: Hierarchical product categories.
    Columns:
      slug:
        Description: Unique slug.
      slug_ci:
        Description: Generated lowercase slug used for case-insensitive uniqueness.
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      updated_at:
        Description: Update timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      name:
        Description: Category name.
      name_ci:
        Description: Generated lowercase name used for case-insensitive search/uniqueness.
      parent_id:
        Description: Parent category (self-FK), nullable.
      deleted_at:
        Description: Soft delete timestamp.
      version:
        Description: Optimistic locking version counter.
      is_live:
        Description: Generated flag (deleted_at IS NULL).
  sync_batch_items:
    Summary: Individual entries inside sync batches.
    Columns:
      id:
        Description: Surrogate primary key.
      error:
        Description: Failure reason, if applicable.
      event_key:
        Description: Event identifier transported in the batch.
      batch_id:
        Description: Parent batch (FK sync_batches.id).
      created_at:
        Description: Creation timestamp (UTC).
      status:
        Description: Item status.
        Enum:
          - pending
          - sent
          - applied
          - failed
          - skipped
  worker_locks:
    Summary: Distributed/DB-backed locks for background workers.
    Columns:
      locked_until:
        Description: Lease expiration time (UTC).
      name:
        Description: Lock name (primary key).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  webhook_outbox:
    Summary: Outbox table for delivering webhooks.
    Columns:
      id:
        Description: Surrogate primary key.
      payload:
        Description: JSON payload.
      event_type:
        Description: Webhook event key.
      retries:
        Description: Retry counter.
      next_attempt_at:
        Description: Next attempt time (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
      version:
        Description: Optimistic locking version counter.
      status:
        Description: Delivery status.
        Enum:
          - pending
          - sent
          - failed
  event_inbox:
    Summary: Inbox table for inbound events awaiting processing.
    Columns:
      source:
        Description: Producer system identifier.
      id:
        Description: Surrogate primary key.
      payload:
        Description: JSON payload to be processed.
      processed_at:
        Description: When processing finished (UTC).
      received_at:
        Description: When the event was received (UTC).
      event_key:
        Description: Event key used for idempotency.
      attempts:
        Description: Number of processing attempts.
      status:
        Description: Processing status flag.
        Enum:
          - pending
          - processed
          - failed
      last_error:
        Description: Last error message written for the event.
  encryption_events:
    Summary: Audit of cryptographic operations.
    Columns:
      field_name:
        Description: Target field.
      id:
        Description: Surrogate primary key.
      entity_table:
        Description: Entity table name.
      policy_id:
        Description: Applied policy (FK encryption_policies.id), optional.
      error_code:
        Description: Error code when failure.
      created_at:
        Description: Timestamp (UTC).
      local_key_version:
        Description: Local key version used.
      layers:
        Description: JSON list of layers/steps.
      entity_pk:
        Description: Entity primary key.
      outcome:
        Description: Result.
        Enum:
          - success
          - failure
      op:
        Description: Operation performed.
        Enum:
          - encrypt
          - decrypt
          - rotate
          - rehash
          - unwrap
          - wrap
  newsletter_subscribers:
    Summary: Newsletter subscription registry with double opt-in. email_hash is UNIQUE; confirm_selector is UNIQUE.
    Columns:
      id:
        Description: Surrogate primary key.
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      origin:
        Description: Acquisition source (e.g., form, import).
      updated_at:
        Description: Update timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      unsubscribed_at:
        Description: Unsubscribe timestamp (UTC).
      unsubscribe_token_hash:
        PII: hashed
        Description: Hashed unsubscribe token.
      confirm_validator_hash:
        PII: hashed
        Description: Hashed validator token.
      ip_hash:
        PII: hashed
        Description: Hashed IP of action.
      confirm_expires:
        Description: Confirmation expiry (UTC).
      email_key_version:
        Description: Key version for email_enc.
      user_id:
        Description: Related user (optional).
      email_enc:
        PII: encrypted
        Description: Encrypted email address.
      confirm_selector:
        Description: Public selector for confirmation (UNIQUE).
      ip_hash_key_version:
        Description: Key version for ip_hash.
      meta:
        Description: JSON metadata (UTM, tags).
      confirm_key_version:
        Description: Key version for confirmation hash.
      unsubscribe_token_key_version:
        Description: Key version for unsubscribe hash.
      email_hash:
        PII: hashed
        Description: Hashed email value (UNIQUE).
      confirmed_at:
        Description: Confirmation timestamp (UTC).
      email_hash_key_version:
        Description: Key version for email_hash.
      version:
        Description: Optimistic locking version counter.
  register_events:
    Summary: Registration related events (success/failure).
    Columns:
      meta:
        Description: JSON metadata.
      id:
        Description: Surrogate primary key.
      type:
        Description: Event type.
        Enum:
          - register_success
          - register_failure
      ip_hash_key_version:
        Description: Key version for ip_hash.
      ip_hash:
        PII: hashed
        Description: Hashed client IP.
      user_agent:
        Description: Client user agent.
      occurred_at:
        Description: When event occurred (UTC).
      user_id:
        Description: User (FK users.id), optional.
  system_jobs:
    Summary: Asynchronous background jobs (generic).
    Columns:
      updated_at:
        Description: Update timestamp (UTC).
      id:
        Description: Surrogate primary key.
      payload:
        Description: JSON payload.
      started_at:
        Description: Start time (UTC).
      retries:
        Description: Retry count.
      error:
        Description: Last error message.
      created_at:
        Description: Creation timestamp (UTC).
      scheduled_at:
        Description: Schedule time (UTC).
      finished_at:
        Description: Finish time (UTC).
      unique_key_hash:
        PII: token
        Description: Deterministic hash of unique key (dedupe).
      unique_key_version:
        Description: Key version used for unique_key_hash.
      locked_until:
        Description: Lock lease expiration time (UTC).
      locked_by:
        Description: Lock owner/worker id.
      status:
        Description: Processing status.
        Enum:
          - pending
          - processing
          - done
          - failed
      job_type:
        Description: Job type key.
      version:
        Description: Optimistic locking version counter.
  policy_algorithms:
    Summary: Weights and priorities for algorithms used within an encryption policy.
    Columns:
      priority:
        Description: Fallback/ordering priority.
      policy_id:
        Description: Encryption policy id (FK encryption_policies.id).
      weight:
        Description: Selection weight.
      algo_id:
        Description: Algorithm id (FK crypto_algorithms.id).
      role:
        Description: Role played by the algorithm.
        Enum:
          - kem
          - sig
          - hash
          - symmetric
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  rbac_sync_cursors:
    Summary: Per-peer replication cursors for RBAC repositories.
    Columns:
      last_commit:
        Description: Last processed commit hash.
      last_synced_at:
        Description: Timestamp when the peer last synced.
      repo_id:
        Description: Repository id (FK rbac_repositories.id).
      peer:
        Description: Consumer identifier (service name).
  two_factor:
    Summary: Second factor configuration per user/method.
    Columns:
      last_used_at:
        Description: Last successful use (UTC).
      method:
        Description: 2FA method key (e.g., totp, hotp, webauthn).
      recovery_codes_enc:
        PII: encrypted
        Description: Encrypted recovery codes.
      recovery_codes_enc_key_version:
        Description: Key version for recovery_codes_enc.
      created_at:
        Description: Creation timestamp (UTC).
      secret:
        PII: encrypted
        Description: Shared secret (encrypted/encoded).
      secret_key_version:
        Description: Key version for secret.
      hotp_counter:
        Description: HOTP counter (if HOTP).
      enabled:
        Description: Whether method is enabled.
      user_id:
        Description: User (FK users.id).
      version:
        Description: Optimistic locking version counter.
  key_wrappers:
    Summary: Composite wrappers protecting DEKs with multiple KMS/crypto layers.
    Columns:
      kms1_key_id:
        Description: Primary wrapping KMS key.
      id:
        Description: Surrogate primary key.
      dek_wrap2:
        Description: Second wrapped DEK blob.
      wrapper_uuid:
        Description: Stable UUID identifier.
      created_at:
        Description: Creation timestamp (UTC).
      kms2_key_id:
        Description: Secondary wrapping KMS key.
      wrap_version:
        Description: Version number for the wrapper format.
      rotated_at:
        Description: When the wrapper was rotated, if ever.
      crypto_suite:
        Description: JSON description of the crypto suite used.
      status:
        Description: Lifecycle flag.
        Enum:
          - active
          - rotated
          - retired
          - invalid
      dek_wrap1:
        Description: First wrapped DEK blob.
  signatures:
    Summary: Digital signatures over critical entities for audit integrity.
    Columns:
      algo_id:
        Description: Signature algorithm (FK crypto_algorithms.id).
      id:
        Description: Surrogate primary key.
      hash_algo_id:
        Description: Hash algorithm used (FK crypto_algorithms.id).
      signing_key_id:
        Description: Signing key used (FK signing_keys.id).
      payload_hash:
        Description: Hash of the signed payload.
      created_at:
        Description: Creation timestamp (UTC).
      signature:
        Description: Binary signature blob.
      subject_table:
        Description: Table of the signed entity.
      context:
        Description: Logical context (audit_chain, event_outbox, etc.).
      subject_pk:
        Description: Primary key of the signed record.
  countries:
    Summary: Country reference list.
    Columns:
      iso2:
        Description: ISO 3166-1 alpha-2 country code (upper case).
      name:
        Description: Official short name.
      created_at:
        Description: Creation timestamp (UTC).
      updated_at:
        Description: Update timestamp (UTC).
  auth_events:
    Summary: Authentication events (logins, resets, lockouts).
    Columns:
      meta:
        Description: Additional JSON metadata (e.g., email used).
      id:
        Description: Surrogate primary key.
      type:
        Description: Auth event kind.
        Enum:
          - login_success
          - login_failure
          - logout
          - password_reset
          - lockout
          - magic_link_request
          - magic_link_throttled
          - magic_link_email_queued
          - device_code_issue
          - device_code_issue_failure
          - device_code_activate_success
          - device_code_activate_failure
          - device_code_poll_success
          - device_code_poll_failure
          - webauthn_register_success
          - webauthn_register_failure
          - webauthn_login_success
          - webauthn_login_failure
      meta_email:
        Description: Generated/stored email extracted from meta for indexing/filtering.
      ip_hash_key_version:
        Description: Key version used for ip_hash.
      ip_hash:
        PII: hashed
        Description: Hashed client IP.
      user_agent:
        Description: Client user agent.
      occurred_at:
        Description: When event happened (UTC).
      user_id:
        Description: Related user (FK users.id).
  audit_log:
    Summary: Immutable trail of data changes across tables.
    Columns:
      table_name:
        Description: Target table name.
      id:
        Description: Surrogate primary key.
      ip_bin:
        PII: plain
        Description: Client IP (binary form).
      ip_bin_key_version:
        Description: Key version for ip_bin.
      old_value:
        Description: JSON snapshot before change.
      new_value:
        Description: JSON snapshot after change.
      change_type:
        Description: Type of change.
        Enum:
          - INSERT
          - UPDATE
          - DELETE
      request_id:
        Description: Correlation/request id if available.
      record_id:
        Description: Primary key of the affected record.
      user_agent:
        Description: Client user agent string.
      changed_by:
        Description: Actor user id (FK users.id) or NULL for system.
      changed_at:
        Description: When change occurred (UTC).
  key_usage:
    Summary: Daily counters of key operations.
    Columns:
      id:
        Description: Surrogate primary key.
      encrypt_count:
        Description: Encrypt operations count.
      decrypt_count:
        Description: Decrypt operations count.
      usage_date:
        Description: UTC date (yyyy-mm-dd).
      last_used_at:
        Description: Last usage timestamp (UTC).
      key_id:
        Description: Key (FK crypto_keys.id).
      verify_count:
        Description: Verify operations count.
  rbac_repo_snapshots:
    Summary: Stored RBAC snapshots pulled from repositories.
    Columns:
      commit_id:
        Description: Commit/version identifier stored.
      taken_at:
        Description: When the snapshot was taken.
      id:
        Description: Surrogate primary key.
      repo_id:
        Description: Source repository (FK rbac_repositories.id).
      metadata:
        Description: JSON metadata associated with the snapshot.
  jwt_tokens:
    Summary: Refresh/API token registry with revocation support.
    Columns:
      id:
        Description: Surrogate primary key.
      type:
        Description: Token kind.
        Enum:
          - refresh
          - api
      scopes:
        Description: Space/comma separated scopes.
      created_at:
        Description: Creation timestamp (UTC).
      ip_hash:
        PII: hashed
        Description: Hashed client IP.
      token_hash:
        PII: hashed
        Description: Hashed token.
      ip_hash_key_version:
        Description: Key version for ip_hash.
      user_id:
        Description: User (FK users.id), optional.
      replaced_by:
        Description: Newer token id (token rotation).
      token_hash_algo:
        Description: Hash algorithm.
      expires_at:
        Description: Expiration timestamp (UTC).
      revoked:
        Description: Revocation flag.
      meta:
        Description: Additional JSON metadata.
      last_used_at:
        Description: Last usage (UTC).
      token_hash_key_version:
        Description: Key version used for token hashing.
      jti:
        Description: JWT ID (unique).
      version:
        Description: Optimistic locking version counter.
  app_settings:
    Summary: Application-wide key/value configuration.
    Columns:
      is_protected:
        Description: Marks sensitive values for redaction in UIs.
      description:
        Description: Human-readable description.
      type:
        Description: Datatype of the value.
        Enum:
          - string
          - int
          - bool
          - json
          - secret
      section:
        Description: Logical group/namespace.
      setting_key:
        Description: Unique setting identifier (natural primary key).
      setting_value:
        Description: Value as text (may contain JSON when type=json).
      updated_by:
        Description: User who changed the setting (FK users.id).
      updated_at:
        Description: Last update timestamp (UTC).
      version:
        Description: Optimistic locking version counter.
  session_audit:
    Summary: Low-level session lifecycle and security events.
    Columns:
      session_token_key_version:
        Description: Key version for session_token_hash.
      id:
        Description: Surrogate primary key.
      ip_hash_key_version:
        Description: Key version for ip_hash.
      session_id:
        Description: Framework session id (string).
      meta_json:
        Description: JSON metadata.
      outcome:
        Description: Outcome label (e.g., success, fail).
      created_at:
        Description: Event timestamp (UTC).
      ip_hash:
        PII: hashed
        Description: Hashed IP.
      user_id:
        Description: User (FK users.id), optional.
      csrf_key_version:
        Description: Key version for csrf_token_hash.
      session_token_hash:
        PII: token
        Description: Hashed session token.
      csrf_token_hash:
        PII: token
        Description: Hashed CSRF token.
      event:
        Description: Event code (e.g., created, rotated, revoked).
      user_agent:
        Description: Client user agent.
  data_retention_policies:
    Summary: Declarative data-retention rules describing purge/anonymize actions.
    Columns:
      field_name:
        Description: Optional column restricted by the policy.
      action:
        Description: Retention action.
        Enum:
          - delete
          - anonymize
          - hash
          - truncate
      entity_table:
        Description: Table affected by the policy.
      id:
        Description: Surrogate primary key.
      notes:
        Description: Operational notes or audit context.
      created_at:
        Description: Creation timestamp (UTC).
      active:
        Description: Whether the policy is currently enforced.
      keep_for:
        Description: Retention window (interval / textual duration).
  merkle_roots:
    Summary: Per-period Merkle root snapshots for append-only data.
    Columns:
      root_hash:
        Description: Merkle root hash (bytea).
      id:
        Description: Surrogate primary key.
      proof_uri:
        Description: Optional URI pointing to notarized proof bundles.
      created_at:
        Description: When the root was stored.
      period_start:
        Description: Start timestamp of the covered period.
      subject_table:
        Description: Table being summarized.
      status:
        Description: Lifecycle state of the Merkle root (pending/anchored/verified/failed).
      period_end:
        Description: End timestamp of the covered period.
      leaf_count:
        Description: Number of leaves included.
  inventory_reservations:
    Summary: Temporary stock reservations tied to orders.
    Columns:
      id:
        Description: Surrogate primary key.
      reserved_until:
        Description: Expiration timestamp (UTC).
      created_at:
        Description: Creation timestamp (UTC).
      order_id:
        Description: Order (FK orders.id), optional.
      quantity:
        Description: Reserved quantity (> 0).
      status:
        Description: Reservation state.
        Enum:
          - pending
          - confirmed
          - expired
          - cancelled
      book_id:
        Description: Book (FK books.id).
      tenant_id:
        Description: Owning tenant (FK tenants.id).
      version:
        Description: Optimistic locking version counter.
FormatVersion: 1.1
